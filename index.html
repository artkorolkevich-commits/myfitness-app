<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MyFitness - –î–Ω–µ–≤–Ω–∏–∫ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</title>
    <style>
      :root {
        --bg: #0f172a;
        --card: #111827;
        --text: #e5e7eb;
        --muted: #94a3b8;
        --accent: #22c55e;
        --warn: #f59e0b;
        --danger: #ef4444;
        --yandex: #fc3f1d;
        --sidebar: #1e293b;
        --sidebar-hover: #334155;
        --sidebar-active: #3b82f6;
      }
      * { box-sizing: border-box; }
      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        background: var(--bg);
        color: var(--text);
        font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        line-height: 1.6;
      }
      
      .app-container {
        display: flex;
        height: 100vh;
      }
      
      /* Sidebar */
      .sidebar {
        width: 280px;
        background: var(--sidebar);
        border-right: 1px solid rgba(148,163,184,0.2);
        display: flex;
        flex-direction: column;
        flex-shrink: 0;
      }
      
      .sidebar-header {
        padding: 24px 20px 16px;
        border-bottom: 1px solid rgba(148,163,184,0.2);
      }
      
      .sidebar-header h1 {
        margin: 0;
        font-size: 20px;
        font-weight: 600;
        color: var(--text);
      }
      
      .sidebar-header p {
        margin: 4px 0 0;
        font-size: 13px;
        color: var(--muted);
      }
      
      .sidebar-nav {
        flex: 1;
        padding: 16px 0;
      }
      
      .nav-item {
        display: flex;
        align-items: center;
        padding: 12px 20px;
        color: var(--text);
        text-decoration: none;
        transition: all 0.2s ease;
        border-left: 3px solid transparent;
        cursor: pointer;
      }
      
      .nav-item:hover {
        background: var(--sidebar-hover);
        color: var(--text);
      }
      
      .nav-item.active {
        background: var(--sidebar-active);
        color: white;
        border-left-color: var(--accent);
      }
      
      .nav-icon {
        width: 20px;
        height: 20px;
        margin-right: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
      }
      
      .nav-text {
        font-size: 14px;
        font-weight: 500;
      }
      
      /* Main Content */
      .main-content {
        flex: 1;
        overflow-y: auto;
        background: radial-gradient(1200px 800px at 20% 0%, #1f2937 0%, var(--bg) 60%);
      }
      
      .content-header {
        padding: 32px 32px 24px;
        border-bottom: 1px solid rgba(148,163,184,0.2);
      }
      
      .content-header h2 {
        margin: 0 0 8px;
        font-size: 24px;
        font-weight: 600;
      }
      
      .content-header p {
        margin: 0;
        color: var(--muted);
        font-size: 16px;
      }
      
      .content-body {
        padding: 32px;
      }
      
      /* Workout Form */
      .workout-form {
        background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
        border: 1px solid rgba(148, 163, 184, 0.2);
        border-radius: 14px;
        padding: 24px;
        margin-bottom: 24px;
      }
      
      .workout-form h3 {
        margin: 0 0 20px;
        font-size: 18px;
        font-weight: 600;
      }
      
      .wf-controls {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 16px;
        margin-bottom: 24px;
      }
      
      .wf-controls .ctrl {
        display: grid;
        grid-template-columns: auto 1fr;
        align-items: center;
        gap: 8px;
      }
      
      .wf-controls label {
        font-size: 13px;
        color: var(--muted);
        white-space: nowrap;
      }
      
      .wf-controls input,
      .wf-controls select {
        background: #0b1220;
        color: var(--text);
        border: 1px solid rgba(148,163,184,0.25);
        border-radius: 8px;
        padding: 8px 10px;
        font-size: 14px;
        outline: none;
      }
      
      .wf-grid {
        display: grid;
        grid-template-columns: 1.2fr 1.4fr 2.2fr;
        gap: 10px;
        align-items: center;
      }
      
      .wf-head {
        font-size: 12px;
        color: var(--muted);
        text-transform: uppercase;
        letter-spacing: .04em;
        border-bottom: 1px solid rgba(148,163,184,0.2);
        padding-bottom: 6px;
        margin-top: 6px;
      }
      
      .wf-row {
        display: contents;
      }
      
      .wf-row .label {
        font-size: 14px;
      }
      
      .wf-row select,
      .wf-row input[type="number"] {
        background: #0b1220;
        color: var(--text);
        border: 1px solid rgba(148,163,184,0.25);
        border-radius: 8px;
        padding: 8px 10px;
        font-size: 14px;
        outline: none;
      }
      
      .sets { display: flex; flex-direction: column; gap: 6px; }
      .set-row { display: grid; grid-template-columns: auto max-content max-content 26px; gap: 6px; align-items: center; }
      .set-row .em-label { font-size: 12px; color: var(--muted); }
      .pair { display: inline-grid; grid-template-columns: auto 80px; align-items: center; column-gap: 4px; }
      
      .btn-secondary {
        background: linear-gradient(180deg, #6b7280, #4b5563);
        color: #fff;
        border: none;
        border-radius: 8px;
        padding: 6px 10px;
        font-size: 13px;
        cursor: pointer;
      }
      
      .remove-set {
        background: transparent;
        color: #ef4444;
        border: 1px solid rgba(239,68,68,0.5);
        border-radius: 6px;
        width: 26px; height: 26px;
        line-height: 24px; text-align: center;
        cursor: pointer;
      }
      
      .wf-actions {
        display: flex;
        gap: 10px;
        margin-top: 16px;
        flex-wrap: wrap;
      }
      
      #saveWorkoutBtn {
        background: linear-gradient(180deg, #22c55e, #16a34a);
        color: white;
        border: none;
        border-radius: 10px;
        padding: 10px 14px;
        font-size: 16px;
        cursor: pointer;
        transition: transform 0.03s ease;
      }
      
      /* Status */
      .status {
        padding: 8px 12px;
        border-radius: 8px;
        font-size: 13px;
        margin-bottom: 8px;
      }
      
      .status.success {
        background: rgba(34,197,94,0.1);
        border: 1px solid rgba(34,197,94,0.3);
        color: var(--accent);
      }
      
      .status.error {
        background: rgba(239,68,68,0.1);
        border: 1px solid rgba(239,68,68,0.3);
        color: var(--danger);
      }
      
      .status.info {
        background: rgba(59,130,246,0.1);
        border: 1px solid rgba(59,130,246,0.3);
        color: #60a5fa;
      }
      
      /* Responsive */
      @media (max-width: 768px) {
        .app-container {
          flex-direction: column;
        }
        
        .sidebar {
          width: 100%;
          height: auto;
        }
        
        .sidebar-nav {
          display: flex;
          overflow-x: auto;
          padding: 12px;
        }
        
        .nav-item {
          flex-shrink: 0;
          padding: 8px 16px;
          border-left: none;
          border-bottom: 3px solid transparent;
        }
        
        .nav-item.active {
          border-left-color: transparent;
          border-bottom-color: var(--accent);
        }
      }
      
      /* Welcome page styles */
      .welcome-card {
        background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
        border: 1px solid rgba(148, 163, 184, 0.2);
        border-radius: 14px;
        padding: 32px;
        text-align: center;
        max-width: 600px;
        margin: 0 auto;
      }
      
      .welcome-icon {
        font-size: 48px;
        margin-bottom: 16px;
        color: var(--accent);
      }
      
      .welcome-title {
        font-size: 28px;
        font-weight: 600;
        margin-bottom: 12px;
      }
      
      .welcome-subtitle {
        font-size: 16px;
        color: var(--muted);
        margin-bottom: 24px;
        line-height: 1.6;
      }
      
      .welcome-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 16px;
        margin-top: 24px;
      }
      
      .stat-item {
        background: rgba(255,255,255,0.03);
        border: 1px solid rgba(148,163,184,0.2);
        border-radius: 10px;
        padding: 16px;
        transition: all 0.2s ease;
      }
      
      .stat-item:hover {
        background: rgba(255,255,255,0.05);
        border-color: var(--accent);
      }
      
      .stat-value {
        font-size: 24px;
        font-weight: 600;
        color: var(--accent);
        margin-bottom: 4px;
      }
      
      .stat-label {
        font-size: 12px;
        color: var(--muted);
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      
      .welcome-features {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 32px;
      }
      
      .feature-item {
        background: rgba(255,255,255,0.02);
        border: 1px solid rgba(148,163,184,0.1);
        border-radius: 10px;
        padding: 20px;
        text-align: left;
      }
      
      .feature-icon {
        font-size: 24px;
        margin-bottom: 12px;
        color: var(--accent);
      }
      
      .feature-title {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 8px;
      }
      
      .feature-desc {
        font-size: 14px;
        color: var(--muted);
        line-height: 1.5;
      }
      
      /* Button styles */
      .btn-primary {
        background: linear-gradient(135deg, var(--accent), #16a34a);
        color: white;
        border: none;
        border-radius: 8px;
        padding: 12px 24px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        text-decoration: none;
        display: inline-block;
      }
      
      .btn-primary:hover {
        background: linear-gradient(135deg, #16a34a, var(--accent));
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
      }
      
      .btn-primary:active {
        transform: translateY(0);
      }
     /* Workout set row: responsive layout fix */
.sets { display: grid; gap: 8px; }

.set-row {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr auto; /* label, reps, weight, remove */
  gap: 8px;
  align-items: center;
  padding: 10px;
  background: rgba(255,255,255,0.03);
  border: 1px solid rgba(148,163,184,0.2);
  border-radius: 8px;
}

.set-row .em-label {
  white-space: nowrap;
  font-size: 12px;
  color: var(--muted);
}

.set-row .pair {
  display: flex;
  align-items: center;
  gap: 8px;
  min-width: 0;
}

.set-row .pair input {
  flex: 1 1 auto;
  width: 100%;
  min-width: 0;
}

.set-row .remove-set {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  border-radius: 6px;
  border: 1px solid rgba(239,68,68,0.4);
  background: rgba(239,68,68,0.08);
  color: var(--danger);
  cursor: pointer;
}

/* Mobile: stack fields, keep remove button in top-right inside row */
@media (max-width: 480px) {
  .set-row {
    grid-template-columns: 1fr auto; /* text + remove */
    grid-auto-rows: auto;
  }
  .set-row .em-label { grid-column: 1 / 2; }
  .set-row .pair { grid-column: 1 / -1; } /* reps and weight take full width */
  .set-row .remove-set {
    grid-column: 2 / 3;
    align-self: start;
  }
} 
      /* Workout set row: mobile fix */
.sets { display: grid; gap: 10px; }

.set-row {
  position: relative;                 /* —á—Ç–æ–±—ã –∫—Ä–µ—Å—Ç–∏–∫ –∂–∏–ª –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞ */
  display: grid;
  grid-template-columns: auto 1fr 1fr 36px;  /* –º–µ—Ç–∫–∞, –ü–æ–≤—Ç., –í–µ—Å, –∫—Ä–µ—Å—Ç–∏–∫ */
  gap: 8px;
  align-items: center;
  padding: 10px 12px;
  background: rgba(255,255,255,0.03);
  border: 1px solid rgba(148,163,184,0.2);
  border-radius: 8px;
}

.set-row .pair {
  display: flex;
  align-items: center;
  gap: 8px;
  min-width: 0;
}

.set-row input,
.set-row select {
  width: 100%;
  min-width: 0;
}

.set-row .remove-set {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 28px;
  height: 28px;
  border-radius: 6px;
  border: 1px solid rgba(239,68,68,0.4);
  background: rgba(239,68,68,0.08);
  color: var(--danger);
  cursor: pointer;
}

/* –£–∑–∫–∏–µ —ç–∫—Ä–∞–Ω—ã: —Å–∫–ª–∞–¥—ã–≤–∞–µ–º –≤ —Å—Ç–æ–ª–±–µ—Ü, –∫—Ä–µ—Å—Ç–∏–∫ ‚Äî –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞ */
@media (max-width: 480px) {
  .set-row {
    grid-template-columns: 1fr;
    padding-right: 48px;              /* –º–µ—Å—Ç–æ –ø–æ–¥ –∫—Ä–µ—Å—Ç–∏–∫ –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞ */
  }
  .set-row .pair { grid-column: 1 / -1; }
  .set-row .remove-set {
    position: absolute;
    top: 8px;
    right: 8px;                       /* –±–æ–ª—å—à–µ –Ω–µ –≤—ã–ª–µ–∑–∞–µ—Ç –∑–∞ –ø—Ä–µ–¥–µ–ª—ã */
  }
}
    </style>
    <link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0f172a">
<link rel="icon" href="icons/icon.svg" type="image/svg+xml">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="MyFitness">
  </head>
  <body>
    <div class="app-container">
      <!-- Sidebar Navigation -->
      <div class="sidebar">
        <div class="sidebar-header">
          <h1>MyFitness</h1>
          <p>–î–Ω–µ–≤–Ω–∏–∫ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</p>
        </div>
        
        <nav class="sidebar-nav">
          <div class="nav-item active" data-page="welcome">
            <div class="nav-icon">üè†</div>
            <div class="nav-text">–ì–ª–∞–≤–Ω–∞—è</div>
          </div>
          <div class="nav-item" data-page="main">
            <div class="nav-icon">üèãÔ∏è</div>
            <div class="nav-text">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</div>
          </div>
          <div class="nav-item" data-page="history">
            <div class="nav-icon">üìä</div>
            <div class="nav-text">–ò—Å—Ç–æ—Ä–∏—è</div>
          </div>
          <div class="nav-item" data-page="settings">
            <div class="nav-icon">‚öôÔ∏è</div>
            <div class="nav-text">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
          </div>
        </nav>
      </div>
      
      <!-- Main Content Area -->
      <div class="main-content">
        <!-- Welcome Page Content -->
        <div id="welcome-page" class="page-content">
          <div class="content-header">
            <h2>–ì–ª–∞–≤–Ω–∞—è</h2>
            <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ MyFitness</p>
          </div>
          
          <div class="content-body">
            <div class="welcome-card">
              <div class="welcome-icon">üí™</div>
              <h3 class="welcome-title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ MyFitness!</h3>
              <p class="welcome-subtitle">
                –í–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫, –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ñ–∏—Ç–Ω–µ—Å-—Ü–µ–ª–µ–π. 
                –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ —Å –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫–æ–º –∏ —Ç—Ä–µ–Ω–∏—Ä—É–π—Ç–µ—Å—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ!
              </p>
              
              <div class="welcome-stats">
                <div class="stat-item">
                  <div class="stat-value" id="totalWorkouts">0</div>
                  <div class="stat-label">–í—Å–µ–≥–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</div>
                </div>
                <div class="stat-item">
                  <div class="stat-value" id="thisWeek">0</div>
                  <div class="stat-label">–ù–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ</div>
                </div>
                <div class="stat-item">
                  <div class="stat-value" id="thisMonth">0</div>
                  <div class="stat-label">–í —ç—Ç–æ–º –º–µ—Å—è—Ü–µ</div>
                </div>
                <div class="stat-item">
                  <div class="stat-value" id="thisYear">0</div>
                  <div class="stat-label">–í —ç—Ç–æ–º –≥–æ–¥—É</div>
                </div>
              </div>
              
              <div class="welcome-features">
                <div class="feature-item">
                  <div class="feature-icon">üìù</div>
                  <div class="feature-title">–í–µ–¥–µ–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</div>
                  <div class="feature-desc">–ó–∞–ø–∏—Å—ã–≤–∞–π—Ç–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –ø–æ —Ü–∏–∫–ª–∞–º, –Ω–µ–¥–µ–ª—è–º –∏ —Å–µ—Å—Å–∏—è–º —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ –ø–æ–¥—Ö–æ–¥–∞–º–∏</div>
                </div>
                <div class="feature-item">
                  <div class="feature-icon">üìä</div>
                  <div class="feature-title">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</div>
                  <div class="feature-desc">–û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É, –≥—Ä–∞—Ñ–∏–∫–∏ –∏ –∏—Å—Ç–æ—Ä–∏—é –≤—Å–µ—Ö –≤–∞—à–∏—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</div>
                </div>
                <div class="feature-item">
                  <div class="feature-icon">‚òÅÔ∏è</div>
                  <div class="feature-title">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è</div>
                  <div class="feature-desc">–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Å –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫–æ–º</div>
                </div>
              </div>
              
              <div style="margin-top: 32px; text-align: center;">
                <button class="btn-primary" onclick="showPage('main')" style="padding: 12px 24px; font-size: 16px;">
                  üèãÔ∏è –ù–∞—á–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É
                </button>
              </div>
              
              <!-- Test data section (only visible in development) -->
              <div style="margin-top: 24px; padding-top: 24px; border-top: 1px solid rgba(148,163,184,0.2);">
                <details style="text-align: left;">
                  <summary style="cursor: pointer; color: var(--muted); font-size: 14px;">
                    üß™ –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
                  </summary>
                  <div style="margin-top: 12px; display: flex; gap: 8px; justify-content: center;">
                    <button onclick="loadTestData()" style="padding: 8px 16px; background: var(--warn); color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">
                      –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
                    </button>
                    <button onclick="clearTestData()" style="padding: 8px 16px; background: var(--danger); color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">
                      –û—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                    </button>
                  </div>
                </details>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Main Page Content -->
        <div id="main-page" class="page-content" style="display: none;">
          <div class="content-header">
            <h2>–ù–æ–≤–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</h2>
            <p>–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –æ –≤–∞—à–µ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–µ</p>
          </div>
          
          <div class="content-body">
            <div class="workout-form">
              <h3>–î–Ω–µ–≤–Ω–∏–∫ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ (FullBody, 3 —Ä–∞–∑–∞/–Ω–µ–¥.)</h3>
              
              <div class="wf-controls">
                <div class="ctrl">
                  <label for="cycle">–¶–∏–∫–ª:</label>
                  <input id="cycle" type="number" min="1" step="1" placeholder="1" />
                </div>
                <div class="ctrl">
                  <label for="week">–ù–µ–¥–µ–ª—è (1‚Äì4):</label>
                  <select id="week">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                  </select>
                </div>
                <div class="ctrl">
                  <label for="session">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ (1‚Äì3):</label>
                  <select id="session">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                  </select>
                </div>
              </div>

              <div class="wf-head wf-grid">
                <div>–ì—Ä—É–ø–ø–∞ –º—ã—à—Ü</div>
                <div>–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</div>
                <div>–ü–æ–¥—Ö–æ–¥—ã (–ø–æ–≤—Ç–æ—Ä—ã –∏ –≤–µ—Å)</div>
              </div>

              <div class="wf-grid wf-row">
                <div class="label">–ì—Ä—É–¥—å</div>
                <select id="ex-chest">
                  <option>–ñ–∏–º –ª–µ–∂–∞</option>
                  <option>–û—Ç–∂–∏–º–∞–Ω–∏—è –Ω–∞ –±—Ä—É—Å—å—è—Ö</option>
                  <option>–ñ–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π –Ω–∞ —Å–∫–∞–º—å–µ 30 –≥—Ä–∞–¥—É—Å–æ–≤</option>
                </select>
                <div class="sets" id="sets-chest"></div>
                <button type="button" class="btn-secondary add-set-btn" data-target="sets-chest">–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Ö–æ–¥</button>
              </div>

              <div class="wf-grid wf-row">
                <div class="label">–°–ø–∏–Ω–∞</div>
                <select id="ex-back">
                  <option>–ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏–µ</option>
                  <option>–¢—è–≥–∞ —à—Ç–∞–Ω–≥–∏</option>
                  <option>–¢—è–≥–∞ –≤ –±–ª–æ—á–Ω–æ–º —Ç—Ä–µ–Ω–∞–∂–µ—Ä–µ</option>
                </select>
                <div class="sets" id="sets-back"></div>
                <button type="button" class="btn-secondary add-set-btn" data-target="sets-back">–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Ö–æ–¥</button>
              </div>

              <div class="wf-grid wf-row">
                <div class="label">–ù–æ–≥–∏</div>
                <select id="ex-legs">
                  <option>–ø—Ä–∏—Å–µ–¥ —Å–æ —à—Ç–∞–Ω–≥–æ–π</option>
                  <option>–≤—ã–ø–∞–¥—ã —Å –≥–∞–Ω—Ç–µ–ª—è–º–∏</option>
                  <option>–ñ–∏–º –Ω–æ–≥–∞–º–∏ –≤ –±–ª–æ—á–Ω–æ–º —Ç—Ä–µ–Ω–∞–∂–µ—Ä–µ</option>
                </select>
                <div class="sets" id="sets-legs"></div>
                <button type="button" class="btn-secondary add-set-btn" data-target="sets-legs">–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Ö–æ–¥</button>
              </div>

              <div class="wf-grid wf-row">
                <div class="label">–ü–ª–µ—á–∏</div>
                <select id="ex-shoulders">
                  <option>–†–∞–∑–≤–µ–¥–µ–Ω–∏–µ –≥–∞–Ω—Ç–µ–ª–µ–π –≤ —Å—Ç–æ—Ä–æ–Ω—ã</option>
                  <option>–¢—è–≥–∞ —à—Ç–∞–Ω–≥–∏ —Å w-–æ–±—Ä–∞–∑–Ω—ã–º –≥—Ä–∏—Ñ–æ–º –∫ –ø–æ–¥–±–æ—Ä–æ–¥–∫—É</option>
                </select>
                <div class="sets" id="sets-shoulders"></div>
                <button type="button" class="btn-secondary add-set-btn" data-target="sets-shoulders">–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Ö–æ–¥</button>
              </div>

              <div class="wf-grid wf-row">
                <div class="label">–ë–∏—Ü–µ–ø—Å</div>
                <select id="ex-biceps">
                  <option>–•–∞–º–º–µ—Ä —Å –≥–∞–Ω—Ç–µ–ª—è–º–∏</option>
                  <option>–ü–æ–¥–Ω—è—Ç–∏–µ —à—Ç–∞–Ω–≥–∏ —Å w-–æ–±—Ä–∞–∑–Ω—ã–º –≥—Ä–∏—Ñ–æ–º</option>
                  <option>–ü–æ–¥–Ω—è—Ç–∏–µ –≥–∞–Ω—Ç–µ–ª–∏ —Å–∏–¥—è —Å —É–ø–æ—Ä–æ–º –≤ —Ç—Ä–∏—Ü–µ–ø—Å</option>
                </select>
                <div class="sets" id="sets-biceps"></div>
                <button type="button" class="btn-secondary add-set-btn" data-target="sets-biceps">–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Ö–æ–¥</button>
              </div>

              <div class="wf-grid wf-row">
                <div class="label">–¢—Ä–∏—Ü–µ–ø—Å</div>
                <select id="ex-triceps">
                  <option>–û–ø—É—Å–∫–∞–Ω–∏–µ –≥–∞–Ω—Ç–µ–ª–∏ –∑–∞ –≥–æ–ª–æ–≤—É</option>
                  <option>–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π –∂–∏–º –≥–∞–Ω—Ç–µ–ª—è–º–∏</option>
                  <option>–ñ–∏–º –≤ –±–ª–æ—á–Ω–æ–º —Ç—Ä–µ–Ω–∞–∂–µ—Ä–µ –Ω–∞ —Ç—Ä–∏—Ü–µ–ø—Å</option>
                </select>
                <div class="sets" id="sets-triceps"></div>
                <button type="button" class="btn-secondary add-set-btn" data-target="sets-triceps">–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Ö–æ–¥</button>
              </div>

              <div class="wf-grid wf-row">
                <div class="label">–ó–∞–¥–Ω–∏–µ –¥–µ–ª—å—Ç—ã</div>
                <select id="ex-reardelt">
                  <option>—Ä–∞–∑–≤–æ–¥–∫–∞ —Ä—É–∫ –≤ —Ç—Ä–µ–Ω–∞–∂–µ—Ä–µ-–±–∞–±–æ—á–∫–µ</option>
                </select>
                <div class="sets" id="sets-reardelt"></div>
                <button type="button" class="btn-secondary add-set-btn" data-target="sets-reardelt">–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Ö–æ–¥</button>
              </div>

              <button id="addSetsToAll" type="button" class="btn-secondary">–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Ö–æ–¥ –≤–æ –≤—Å–µ –≥—Ä—É–ø–ø—ã</button>
              
              <div class="wf-actions">
                <button id="saveWorkoutBtn" type="button">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</button>
                <button id="syncBtn" type="button" class="btn-secondary">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å</button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- History Page Content -->
        <div id="history-page" class="page-content" style="display: none;">
          <div class="content-header">
            <h2>–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</h2>
            <p>–ü—Ä–æ—Å–º–æ—Ç—Ä –∏ –∞–Ω–∞–ª–∏–∑ –≤–∞—à–∏—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</p>
          </div>
          
          <div class="content-body">
            <div id="history-content">
              <!-- History content will be loaded here -->
            </div>
          </div>
        </div>
        
        <!-- Settings Page Content -->
        <div id="settings-page" class="page-content" style="display: none;">
          <div class="content-header">
            <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
            <p>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏</p>
          </div>
          
          <div class="content-body">
            <div id="settings-content">
              <!-- Settings content will be loaded here -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Navigation functionality
      document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', () => {
          const page = item.getAttribute('data-page');
          showPage(page);
          
          // Update active state
          document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
          item.classList.add('active');
        });
      });
      
      function showPage(pageName) {
        // Hide all pages
        document.querySelectorAll('.page-content').forEach(page => {
          page.style.display = 'none';
        });
        
        // Show selected page
        const targetPage = document.getElementById(pageName + '-page');
        if (targetPage) {
          targetPage.style.display = 'block';
        }
        
        // Load page content if needed
        if (pageName === 'welcome') {
          loadWelcomePage();
        } else if (pageName === 'history') {
          loadHistoryPage();
        } else if (pageName === 'settings') {
          loadSettingsPage();
        }
        
        // Update page title
        const pageTitles = {
          'welcome': '–ì–ª–∞–≤–Ω–∞—è',
          'main': '–ù–æ–≤–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞',
          'history': '–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫',
          'settings': '–ù–∞—Å—Ç—Ä–æ–π–∫–∏'
        };
        
        const pageTitle = document.querySelector('.content-header h2');
        if (pageTitle && pageTitles[pageName]) {
          pageTitle.textContent = pageTitles[pageName];
        }
      }
      
      async function loadWelcomePage() {
        // Load statistics from localStorage
        try {
          const workouts = JSON.parse(localStorage.getItem('workouts') || '[]');
          const now = new Date();
          const currentWeek = getWeekNumber(now);
          const currentMonth = now.getMonth();
          const currentYear = now.getFullYear();
          
          let totalWorkouts = workouts.length;
          let thisWeekCount = 0;
          let thisMonthCount = 0;
          let thisYearCount = 0;
          
          workouts.forEach(workout => {
            const workoutDate = new Date(workout.date);
            const workoutWeek = getWeekNumber(workoutDate);
            const workoutMonth = workoutDate.getMonth();
            const workoutYear = workoutDate.getFullYear();
            
            if (workoutYear === currentYear) {
              thisYearCount++;
              if (workoutMonth === currentMonth) {
                thisMonthCount++;
                if (workoutWeek === currentWeek) {
                  thisWeekCount++;
                }
              }
            }
          });
          
          // Update statistics
          document.getElementById('totalWorkouts').textContent = totalWorkouts;
          document.getElementById('thisWeek').textContent = thisWeekCount;
          document.getElementById('thisMonth').textContent = thisMonthCount;
          document.getElementById('thisYear').textContent = thisYearCount;
          
        } catch (e) {
          console.warn('Failed to load welcome page statistics:', e);
        }
      }
      
      function getWeekNumber(date) {
        const firstDayOfYear = new Date(date.getFullYear(), 0, 1);
        const pastDaysOfYear = (date - firstDayOfYear) / 86400000;
        return Math.ceil((pastDaysOfYear + firstDayOfYear.getDay() + 1) / 7);
      }
      
      async function loadHistoryPage() {
        const historyContent = document.getElementById('history-content');
        historyContent.innerHTML = `
          <div style="text-align: center; padding: 40px;">
            <h3>–ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏...</h3>
            <p>–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∑–¥–µ—Å—å</p>
          </div>
        `;
        
        try {
          const response = await fetch('./history.html');
          const html = await response.text();
          
          // Extract body content
          const parser = new DOMParser();
          const doc = parser.parseFromString(html, 'text/html');
          const bodyContent = doc.body.querySelector('.container');
          
          if (bodyContent) {
            historyContent.innerHTML = bodyContent.innerHTML;
            // Re-initialize history page scripts
            initializeHistoryPage();
          }
        } catch (e) {
          historyContent.innerHTML = `
            <div style="text-align: center; padding: 40px; color: var(--danger);">
              <h3>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h3>
              <p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏—Å—Ç–æ—Ä–∏–∏</p>
            </div>
          `;
        }
      }
      
      async function loadSettingsPage() {
        const settingsContent = document.getElementById('settings-content');
        settingsContent.innerHTML = `
          <div style="text-align: center; padding: 40px;">
            <h3>–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫...</h3>
            <p>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å</p>
          </div>
        `;
        
        try {
          const response = await fetch('./settings.html');
          const html = await response.text();
          
          // Extract body content
          const parser = new DOMParser();
          const doc = parser.parseFromString(html, 'text/html');
          const bodyContent = doc.body.querySelector('.container');
          
          if (bodyContent) {
            settingsContent.innerHTML = bodyContent.innerHTML;
            // Re-initialize settings page scripts
            initializeSettingsPage();
          }
        } catch (e) {
          settingsContent.innerHTML = `
            <div style="text-align: center; padding: 40px; color: var(--danger);">
              <h3>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h3>
              <p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–∞—Å—Ç—Ä–æ–µ–∫</p>
            </div>
          `;
        }
      }
      
      function initializeHistoryPage() {
        // Initialize history page functionality
        const mockWorkouts = [
          {
            id: 1,
            date: '2024-01-15T10:30:00Z',
            cycle: 1,
            week: 1,
            session: 1,
            exercises: [
              {
                group: '–ì—Ä—É–¥—å',
                exercise: '–ñ–∏–º –ª–µ–∂–∞',
                sets: [
                  { reps: 10, weight: 80 },
                  { reps: 8, weight: 85 },
                  { reps: 6, weight: 90 }
                ]
              }
            ]
          }
        ];
        
        let currentWorkouts = [...mockWorkouts];
        
        function updateStats(workouts) {
          const totalWorkouts = workouts.length;
          const thisMonth = workouts.filter(w => {
            const workoutDate = new Date(w.date);
            const now = new Date();
            return workoutDate.getMonth() === now.getMonth() && 
                   workoutDate.getFullYear() === now.getFullYear();
          }).length;
          
          const totalSets = workouts.reduce((sum, w) => {
            return sum + w.exercises.reduce((exSum, ex) => exSum + ex.sets.length, 0);
          }, 0);
          
          const allWeights = workouts.flatMap(w => 
            w.exercises.flatMap(ex => 
              ex.sets.map(s => s.weight).filter(w => w !== null)
            )
          );
          const avgWeight = allWeights.length > 0 
            ? Math.round(allWeights.reduce((sum, w) => sum + w, 0) / allWeights.length)
            : 0;

          const totalWorkoutsEl = document.getElementById('totalWorkouts');
          const thisMonthEl = document.getElementById('thisMonth');
          const totalSetsEl = document.getElementById('totalSets');
          const avgWeightEl = document.getElementById('avgWeight');
          
          if (totalWorkoutsEl) totalWorkoutsEl.textContent = totalWorkouts;
          if (thisMonthEl) thisMonthEl.textContent = thisMonth;
          if (totalSetsEl) totalSetsEl.textContent = totalSets;
          if (avgWeightEl) avgWeightEl.textContent = avgWeight;
        }

        function renderWorkouts(workouts) {
          const historyList = document.getElementById('historyList');
          if (!historyList) return;
          
          if (workouts.length === 0) {
            historyList.innerHTML = `
              <div class="empty-state">
                <h3>–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</h3>
                <p>–ù–∞—á–Ω–∏—Ç–µ —Å –ø–µ—Ä–≤–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∑–¥–µ—Å—å –≤–∞—à–∏ –∑–∞–ø–∏—Å–∏</p>
              </div>
            `;
            return;
          }

          historyList.innerHTML = workouts.map(workout => {
            const date = new Date(workout.date);
            const exercisesHtml = workout.exercises.map(exercise => {
              const setsHtml = exercise.sets.map((set, index) => 
                `<span class="set-badge">${index + 1}) ${set.reps}√ó${set.weight || '‚Äî'}–∫–≥</span>`
              ).join('');
              
              return `
                <div class="exercise-item">
                  <div class="exercise-header">
                    <div class="exercise-name">${exercise.exercise}</div>
                    <div class="exercise-group">${exercise.group}</div>
                  </div>
                  <div class="sets-list">${setsHtml}</div>
                </div>
              `;
            }).join('');

            return `
              <div class="history-item">
                <div class="history-header">
                  <div class="history-meta">
                    <div class="history-title">–¶–∏–∫–ª ${workout.cycle}, –ù–µ–¥–µ–ª—è ${workout.week}, –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ ${workout.session}</div>
                    <div class="history-date">${date.toLocaleDateString('ru-RU', { 
                      year: 'numeric', 
                      month: 'long', 
                      day: 'numeric',
                      hour: '2-digit',
                      minute: '2-digit'
                    })}</div>
                  </div>
                  <div class="history-stats">
                    <span>${workout.exercises.length} —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</span>
                    <span>${workout.exercises.reduce((sum, ex) => sum + ex.sets.length, 0)} –ø–æ–¥—Ö–æ–¥–æ–≤</span>
                  </div>
                </div>
                <div class="history-exercises">${exercisesHtml}</div>
              </div>
            `;
          }).join('');
        }

        function applyFilters() {
          const cycle = document.getElementById('filterCycle')?.value;
          const week = document.getElementById('filterWeek')?.value;
          const session = document.getElementById('filterSession')?.value;
          const date = document.getElementById('filterDate')?.value;

          let filtered = [...mockWorkouts];

          if (cycle) {
            filtered = filtered.filter(w => w.cycle === parseInt(cycle));
          }
          if (week) {
            filtered = filtered.filter(w => w.week === parseInt(week));
          }
          if (session) {
            filtered = filtered.filter(w => w.session === parseInt(session));
          }
          if (date) {
            filtered = filtered.filter(w => {
              const workoutDate = new Date(w.date).toISOString().split('T')[0];
              return workoutDate === date;
            });
          }

          currentWorkouts = filtered;
          updateStats(filtered);
          renderWorkouts(filtered);
        }

        function clearFilters() {
          const filterCycle = document.getElementById('filterCycle');
          const filterWeek = document.getElementById('filterWeek');
          const filterSession = document.getElementById('filterSession');
          const filterDate = document.getElementById('filterDate');
          
          if (filterCycle) filterCycle.value = '';
          if (filterWeek) filterWeek.value = '';
          if (filterSession) filterSession.value = '';
          if (filterDate) filterDate.value = '';
          
          currentWorkouts = [...mockWorkouts];
          updateStats(currentWorkouts);
          renderWorkouts(currentWorkouts);
        }

        // Event listeners
        const applyFiltersBtn = document.getElementById('applyFilters');
        const clearFiltersBtn = document.getElementById('clearFilters');
        
        if (applyFiltersBtn) applyFiltersBtn.addEventListener('click', applyFilters);
        if (clearFiltersBtn) clearFiltersBtn.addEventListener('click', clearFilters);

        // Initialize
        updateStats(currentWorkouts);
        renderWorkouts(currentWorkouts);
      }
      
      function initializeSettingsPage() {
        // Configuration management
        const CONFIG_KEY = 'myfitness_config';
        
        let config = {
          yandexToken: '',
          yandexPath: '/workouts.json',
          autoSync: true,
          syncInterval: 15,
          defaultCycle: 1,
          theme: 'dark'
        };
        
        function loadConfig() {
          try {
            const saved = localStorage.getItem(CONFIG_KEY);
            if (saved) {
              config = { ...config, ...JSON.parse(saved) };
              applyConfigToUI();
            }
          } catch (e) {
            console.warn('Failed to load config:', e);
          }
        }
        
        function saveConfig() {
          try {
            const yandexToken = document.getElementById('yandexToken')?.value;
            const yandexPath = document.getElementById('yandexPath')?.value;
            const autoSync = document.getElementById('autoSync')?.checked;
            const syncInterval = parseInt(document.getElementById('syncInterval')?.value);
            const defaultCycle = parseInt(document.getElementById('defaultCycle')?.value);
            const theme = document.getElementById('theme')?.value;
            
            if (yandexToken !== undefined) config.yandexToken = yandexToken;
            if (yandexPath !== undefined) config.yandexPath = yandexPath;
            if (autoSync !== undefined) config.autoSync = autoSync;
            if (syncInterval) config.syncInterval = syncInterval;
            if (defaultCycle) config.defaultCycle = defaultCycle;
            if (theme) config.theme = theme;
            
            localStorage.setItem(CONFIG_KEY, JSON.stringify(config));
            showStatus('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã', 'success');
          } catch (e) {
            console.warn('Failed to save config:', e);
            showStatus('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫', 'error');
          }
        }
        
        function applyConfigToUI() {
          const yandexToken = document.getElementById('yandexToken');
          const yandexPath = document.getElementById('yandexPath');
          const autoSync = document.getElementById('autoSync');
          const syncInterval = document.getElementById('syncInterval');
          const defaultCycle = document.getElementById('defaultCycle');
          const theme = document.getElementById('theme');
          
          if (yandexToken) yandexToken.value = config.yandexToken;
          if (yandexPath) yandexPath.value = config.yandexPath;
          if (autoSync) autoSync.checked = config.autoSync;
          if (syncInterval) syncInterval.value = config.syncInterval;
          if (defaultCycle) defaultCycle.value = config.defaultCycle;
          if (theme) theme.value = config.theme;
        }
        
        function showStatus(message, type = 'info') {
          const statusEl = document.getElementById('connectionStatus');
          if (statusEl) {
            statusEl.innerHTML = `<div class="status ${type}">${message}</div>`;
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
              statusEl.innerHTML = '';
            }, 5000);
          }
        }
        
        async function testYandexConnection() {
          const token = document.getElementById('yandexToken')?.value.trim();
          
          if (!token) {
            showStatus('–í–≤–µ–¥–∏—Ç–µ OAuth —Ç–æ–∫–µ–Ω –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è', 'error');
            return;
          }
          
          try {
            const btn = document.getElementById('testConnection');
            if (btn) {
              btn.disabled = true;
              btn.textContent = '–ü—Ä–æ–≤–µ—Ä–∫–∞...';
            }
            
            const response = await fetch('https://cloud-api.yandex.net/v1/disk', {
              headers: {
                'Authorization': `OAuth ${token}`
              }
            });
            
            if (response.ok) {
              const data = await response.json();
              const total = Number(data.total_space);
              const used = Number(data.used_space);
              const available = total - used;
              
              showStatus(
                `–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ! –î–æ—Å—Ç—É–ø–Ω–æ –º–µ—Å—Ç–∞: ${Math.round(available / 1024 / 1024 / 1024)} –ì–ë`, 
                'success'
              );
            } else {
              showStatus(`–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${response.status} ${response.statusText}`, 'error');
            }
          } catch (e) {
            showStatus(`–û—à–∏–±–∫–∞: ${e.message}`, 'error');
          } finally {
            const btn = document.getElementById('testConnection');
            if (btn) {
              btn.disabled = false;
              btn.textContent = '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ';
            }
          }
        }
        
        // Event listeners
        const testConnectionBtn = document.getElementById('testConnection');
        const syncNowBtn = document.getElementById('syncNow');
        const exportDataBtn = document.getElementById('exportData');
        const importDataBtn = document.getElementById('importData');
        const clearDataBtn = document.getElementById('clearData');
        
        if (testConnectionBtn) testConnectionBtn.addEventListener('click', testYandexConnection);
        if (syncNowBtn) syncNowBtn.addEventListener('click', () => {
          showStatus('–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–ø—É—â–µ–Ω–∞...', 'info');
          setTimeout(() => {
            showStatus('–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞', 'success');
          }, 2000);
        });
        
        // Auto-save on input changes
        [
          'yandexToken', 'yandexPath', 'autoSync', 'syncInterval', 'defaultCycle', 'theme'
        ].forEach(id => {
          const element = document.getElementById(id);
          if (element) {
            if (element.type === 'checkbox') {
              element.addEventListener('change', saveConfig);
            } else {
              element.addEventListener('blur', saveConfig);
            }
          }
        });
        
        // Initialize
        loadConfig();
      }
      
      // Initialize main page functionality
      const CONFIG_KEY = 'yandex_disk_config';
      const cycleEl = document.getElementById('cycle');
      const weekEl = document.getElementById('week');
      const sessionEl = document.getElementById('session');
      const addSetsToAllBtn = document.getElementById('addSetsToAll');
      const saveBtn = document.getElementById('saveWorkoutBtn');
      const syncBtn = document.getElementById('syncBtn');

      const groups = [
        { group: '–ì—Ä—É–¥—å', ex: 'ex-chest', setsContainer: 'sets-chest' },
        { group: '–°–ø–∏–Ω–∞', ex: 'ex-back', setsContainer: 'sets-back' },
        { group: '–ù–æ–≥–∏', ex: 'ex-legs', setsContainer: 'sets-legs' },
        { group: '–ü–ª–µ—á–∏', ex: 'ex-shoulders', setsContainer: 'sets-shoulders' },
        { group: '–ë–∏—Ü–µ–ø—Å', ex: 'ex-biceps', setsContainer: 'sets-biceps' },
        { group: '–¢—Ä–∏—Ü–µ–ø—Å', ex: 'ex-triceps', setsContainer: 'sets-triceps' },
        { group: '–ó–∞–¥–Ω–∏–µ –¥–µ–ª—å—Ç—ã', ex: 'ex-reardelt', setsContainer: 'sets-reardelt' },
      ];

      let config = {
        token: '',
        path: '/workouts.json'
      };

      function loadConfig() {
        try {
          const saved = localStorage.getItem(CONFIG_KEY);
          if (saved) {
            config = { ...config, ...JSON.parse(saved) };
          }
        } catch (e) {
          console.warn('Failed to load config:', e);
        }
      }

      function createSetRow(index) {
        const row = document.createElement('div');
        row.className = 'set-row';
        row.innerHTML = `
          <span class="em-label">–ü–æ–¥—Ö–æ–¥ ${index + 1}</span>
          <div class="pair"><span class="em-label">–ü–æ–≤—Ç.</span><input type="number" class="reps" min="1" max="50" placeholder="10" /></div>
          <div class="pair"><span class="em-label">–í–µ—Å</span><input type="number" class="weight" min="0" max="700" step="0.5" placeholder="–∫–≥" /></div>
          <button type="button" class="remove-set" title="–£–¥–∞–ª–∏—Ç—å">√ó</button>
        `;
        return row;
      }

      function addSet(container) {
        const index = container.querySelectorAll('.set-row').length;
        const row = createSetRow(index);
        container.appendChild(row);
        row.querySelector('.remove-set').addEventListener('click', () => {
          row.remove();
          renumberSets(container);
        });
      }

      function renumberSets(container) {
        container.querySelectorAll('.set-row .em-label:first-child').forEach((el, idx) => {
          el.textContent = `–ü–æ–¥—Ö–æ–¥ ${idx + 1}`;
        });
      }

      function ensureInitialSets() {
        groups.forEach(g => {
          const container = document.getElementById(g.setsContainer);
          if (container.children.length === 0) {
            addSet(container);
          }
        });
      }

      function collectCurrentEntry() {
        const cycle = Number(cycleEl.value) || 1;
        const week = Number(weekEl.value);
        const session = Number(sessionEl.value);

        const exercises = groups.map(g => {
          const exerciseName = document.getElementById(g.ex).value;
          const container = document.getElementById(g.setsContainer);
          const sets = Array.from(container.querySelectorAll('.set-row')).map(row => {
            const repsVal = Number(row.querySelector('input.reps').value);
            const weightVal = Number(row.querySelector('input.weight').value);
            return {
              reps: Number.isFinite(repsVal) ? repsVal : null,
              weight: Number.isFinite(weightVal) ? weightVal : null,
            };
          });
          return {
            group: g.group,
            exercise: exerciseName,
            sets,
          };
        });

        return {
          id: Date.now(),
          date: new Date().toISOString(),
          cycle,
          week,
          session,
          exercises,
        };
      }

      async function handleSave() {
        if (!cycleEl.value) {
          alert('–£–∫–∞–∂–∏—Ç–µ –Ω–æ–º–µ—Ä —Ü–∏–∫–ª–∞');
          return;
        }

        const entry = collectCurrentEntry();

        const hasAnySet = entry.exercises.some(ex => ex.sets.some(s => (s.reps && s.reps > 0) || (s.weight && s.weight > 0)));
        if (!hasAnySet) {
          if (!confirm('–í—ã –Ω–µ —É–∫–∞–∑–∞–ª–∏ –Ω–∏ –æ–¥–∏–Ω –ø–æ–¥—Ö–æ–¥. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å?')) return;
        }

        try {
          saveBtn.disabled = true;
          saveBtn.textContent = '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...';
          
          // Save to localStorage for now
          const workouts = JSON.parse(localStorage.getItem('workouts') || '[]');
          workouts.push(entry);
          localStorage.setItem('workouts', JSON.stringify(workouts));
          
          showStatus('–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!', 'success');
          
          // Update welcome page statistics if it's visible
          if (document.getElementById('welcome-page').style.display !== 'none') {
            loadWelcomePage();
          }
          
          // Clear form
          cycleEl.value = '';
          groups.forEach(g => {
            const container = document.getElementById(g.setsContainer);
            container.innerHTML = '';
            addSet(container);
          });
          
        } catch (e) {
          console.error('Save failed:', e);
          showStatus(`–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ${e.message}`, 'error');
        } finally {
          saveBtn.disabled = false;
          saveBtn.textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É';
        }
      }

      function addSetToAll() {
        groups.forEach(g => {
          const container = document.getElementById(g.setsContainer);
          addSet(container);
        });
      }

      function showStatus(message, type = 'info') {
        // Create status element if it doesn't exist
        let statusEl = document.querySelector('.workout-form .status');
        if (!statusEl) {
          statusEl = document.createElement('div');
          statusEl.className = 'status';
          document.querySelector('.workout-form').insertBefore(statusEl, document.querySelector('.wf-actions'));
        }
        
        statusEl.className = `status ${type}`;
        statusEl.textContent = message;
        
        // Auto-hide after 5 seconds
        setTimeout(() => {
          statusEl.remove();
        }, 5000);
      }

      // Wire per-group add buttons
      document.querySelectorAll('.add-set-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const targetId = btn.getAttribute('data-target');
          const container = document.getElementById(targetId);
          addSet(container);
        });
      });

      // Event listeners
      saveBtn.addEventListener('click', handleSave);
      addSetsToAllBtn.addEventListener('click', addSetToAll);
      syncBtn.addEventListener('click', () => {
        showStatus('–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫–æ–º...', 'info');
        // TODO: Implement actual sync
        setTimeout(() => {
          showStatus('–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞', 'success');
        }, 2000);
      });

      // Initialize
      loadConfig();
      ensureInitialSets();
      
      // Initialize welcome page
      loadWelcomePage();
      
      // Test data functions
      function loadTestData() {
        const testWorkouts = [
          {
            date: new Date(2024, 11, 15).toISOString(),
            cycle: 1,
            week: 1,
            session: 1,
            exercises: [
              {
                group: '–ì—Ä—É–¥—å',
                exercise: '–ñ–∏–º –ª–µ–∂–∞',
                sets: [
                  { reps: 10, weight: 60 },
                  { reps: 8, weight: 65 },
                  { reps: 6, weight: 70 }
                ]
              }
            ]
          },
          {
            date: new Date(2024, 11, 17).toISOString(),
            cycle: 1,
            week: 1,
            session: 2,
            exercises: [
              {
                group: '–°–ø–∏–Ω–∞',
                exercise: '–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è',
                sets: [
                  { reps: 8, weight: 0 },
                  { reps: 6, weight: 0 },
                  { reps: 5, weight: 0 }
                ]
              }
            ]
          },
          {
            date: new Date(2024, 11, 20).toISOString(),
            cycle: 1,
            week: 2,
            session: 1,
            exercises: [
              {
                group: '–ù–æ–≥–∏',
                exercise: '–ü—Ä–∏—Å–µ–¥ —Å–æ —à—Ç–∞–Ω–≥–æ–π',
                sets: [
                  { reps: 12, weight: 80 },
                  { reps: 10, weight: 85 },
                  { reps: 8, weight: 90 }
                ]
              }
            ]
          },
          {
            date: new Date(2025, 0, 5).toISOString(),
            cycle: 2,
            week: 1,
            session: 1,
            exercises: [
              {
                group: '–ü–ª–µ—á–∏',
                exercise: '–†–∞–∑–≤–µ–¥–µ–Ω–∏–µ –≥–∞–Ω—Ç–µ–ª–µ–π –≤ —Å—Ç–æ—Ä–æ–Ω—ã',
                sets: [
                  { reps: 12, weight: 8 },
                  { reps: 10, weight: 10 },
                  { reps: 8, weight: 12 }
                ]
              }
            ]
          },
          {
            date: new Date(2025, 0, 7).toISOString(),
            cycle: 2,
            week: 1,
            session: 2,
            exercises: [
              {
                group: '–ë–∏—Ü–µ–ø—Å',
                exercise: '–•–∞–º–º–µ—Ä —Å –≥–∞–Ω—Ç–µ–ª—è–º–∏',
                sets: [
                  { reps: 12, weight: 12 },
                  { reps: 10, weight: 14 },
                  { reps: 8, weight: 16 }
                ]
              }
            ]
          }
        ];
        
        localStorage.setItem('workouts', JSON.stringify(testWorkouts));
        alert('–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã! –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏.');
      }
      
      function clearTestData() {
        localStorage.removeItem('workouts');
        alert('–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω—ã!');
        loadWelcomePage(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
      }
    </script>
    <script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function () {
    navigator.serviceWorker.register('./service-worker.js')
      .catch(function (e) { console.warn('SW registration failed', e); });
  });
}
</script>
  </body>
</html>
